(self["webpackChunk"]=self["webpackChunk"]||[]).push([[267],{38858:function(t,i,e){"use strict";e.r(i),e.d(i,{default:function(){return C}});e(57663);var h,s,a,r,n=e(71577),l=(e(43358),e(34041)),o=e(67294),c=e(28216),p=e(57958),d=e(95094),g=e(62514),m=e(69538),v=e(35151),f=e(44535),u=e(22095),y=e(71720),w=e(85893),R=t=>t.map((t=>[...t])),x=(h=(0,y.$j)((t=>{var i=t.configProvider;return{configProvider:i}}),null,null,{forwardRef:!0}),h(s=class extends o.Component{constructor(){var t;super(...arguments),t=this,this.instance=(0,o.createRef)(),this.container=(0,o.createRef)(),this.name=this.props.name,this.zr=null,this.rate=this.props.configProvider.calibrator.rate,this.clipRectRate=this.props.configProvider.calibrator.clipRectRate,this.path=R(this.props.configProvider.calibrator.cameras[this.name].path),this.aspectRatio=this.props.configProvider.calibrator.cameras[this.name].aspectRatio,this.w=0,this.h=0,this.state={width:"90%",height:"10%",imgUrl:"/api/camera?cam="+encodeURIComponent(this.name)},this.circle=[],this.polygon=null,this.polyline=null,this.clipRect=null,this.img=null,this.fillRect=null,this.line1=null,this.line2=null,this.refresh=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t.name=i||t.props.name,t.path=R(t.props.configProvider.calibrator.cameras[t.name].path),t.aspectRatio=t.props.configProvider.calibrator.cameras[t.name].aspectRatio,t.setState({imgUrl:"/api/camera?cam="+encodeURIComponent(t.name)});var e=t,h=t=>[t[0]*e.w,t[1]*e.h];t.polygon.setShape({points:t.path.map(h)}),t.polyline.setShape({points:[...t.path,t.path[0]].map(h)});for(var s=0;s<t.circle.length;s++)t.circle[s].attr("position",h(t.path[s]));t.img.attr({style:{image:"/api/camera?cam="+encodeURIComponent(t.name)}})}}componentDidMount(){var t=!1;this.zr=p.S1(this.instance.current),this.w=this.zr.getWidth(),this.h=this.zr.getHeight();var i=this,e=t=>[t[0]*i.w,t[1]*i.h];this.zr.on("mousedown",(i=>{var e;t=null===(e=i.target)||void 0===e?void 0:e.id,(t||0===t)&&t<this.path.length&&t>=0&&(this.clipRect.show(),this.img.show(),this.line1.show(),this.line2.show(),this.fillRect.show())})),this.zr.on("mouseup",(()=>{(t||0===t)&&t<this.path.length&&t>=0&&(a(this.circle[t]),this.clipRect.hide(),this.img.hide(),this.line1.hide(),this.line2.hide(),this.fillRect.hide()),t=!1})),this.polygon=new d.Z({style:{fill:"#fff",opacity:.3},shape:{points:this.path.map(e)}}),this.polyline=new g.Z({style:{stroke:"#fff",lineWidth:2},shape:{points:[...this.path,this.path[0]].map(e)}});for(var h=0;h<this.path.length;h++)this.circle.push(new m.Z({id:h,style:{fill:"#fff"},shape:{cx:0,cy:0,r:5},position:e(this.path[h]),draggable:!0}).on("mousemove",(i=>{(t||0===t)&&a(i.target);var e=r(i.target);this.clipRect.setShape({x:e.x,y:e.y,width:e.width,height:e.height}),this.fillRect.setShape({x:e.x,y:e.y,width:e.width,height:e.height}),this.line1.setShape({x1:e.x,y1:e.y+e.height/2,x2:e.x+e.width,y2:e.y+e.height/2}),this.line2.setShape({x1:e.x+e.width/2,y1:e.y,x2:e.x+e.width/2,y2:e.y+e.height}),this.img.attr({style:{x:e.imgX,y:e.imgY}})})));this.zr.add(this.polygon),this.zr.add(this.polyline);for(var s=0;s<this.circle.length;s++)this.zr.add(this.circle[s]);function a(t){i.path[t.id]=[t.x/i.w,t.y/i.h],i.polygon.setShape({points:i.path.map(e)}),i.polyline.setShape({points:[...i.path,i.path[0]].map(e)})}function r(t){var e=i.w*i.clipRectRate,h=i.h*i.clipRectRate,s=0,a=0;t.x<i.w/2&&(s=i.w-e),t.y<i.h/2&&(a=i.h-h);var r=s+e/2-t.x*i.rate,n=a+h/2-t.y*i.rate;return{x:s,y:a,width:e,height:h,imgX:r,imgY:n}}function n(){var t,h,s,a,r,n,l=null===(t=i.container)||void 0===t||null===(h=t.current)||void 0===h||null===(s=h.parentNode)||void 0===s?void 0:s.clientWidth,o=null===(a=i.container)||void 0===a||null===(r=a.current)||void 0===r||null===(n=r.parentNode)||void 0===n?void 0:n.clientHeight;if(l&&o){var c=Math.round(l/i.aspectRatio);c>o&&(c=o,l=Math.round(c*i.aspectRatio)),i.setState({width:l.toString()+"px",height:c.toString()+"px"}),i.zr.resize(),i.w=i.zr.getWidth(),i.h=i.zr.getHeight(),i.polygon.setShape({points:i.path.map(e)}),i.polyline.setShape({points:[...i.path,i.path[0]].map(e)});for(var p=0;p<i.circle.length;p++)i.circle[p].attr("position",e(i.path[p]));i.img.attr({style:{width:i.w*i.rate,height:i.h*i.rate}})}}this.clipRect=new v.Z({style:{fill:"none",stroke:"#fff",lineWidth:2},shape:{x:0,y:0,width:this.w*this.clipRectRate,height:this.h*this.clipRectRate},zlevel:3}),this.clipRect.hide(),this.img=new f.ZP({style:{image:this.state.imgUrl,x:0,y:0,width:this.w*this.rate,height:this.h*this.rate},zlevel:2}),this.img.setClipPath(this.clipRect),this.img.hide(),this.fillRect=new v.Z({style:{fill:"#000"},shape:{x:0,y:0,width:this.w*this.clipRectRate,height:this.h*this.clipRectRate},zlevel:1}),this.fillRect.hide(),this.line1=new u.Z({style:{stroke:"#fff",lineWidth:2},shape:{x1:0,y1:this.h*this.clipRectRate/2,x2:this.w,y2:this.h*this.clipRectRate/2},zlevel:3}),this.line2=new u.Z({style:{stroke:"#fff",lineWidth:2},shape:{x1:this.w*this.clipRectRate/2,y1:0,x2:this.w*this.clipRectRate/2,y2:this.h},zlevel:3}),this.line1.hide(),this.line2.hide(),this.zr.add(this.clipRect),this.zr.add(this.fillRect),this.zr.add(this.img),this.zr.add(this.line1),this.zr.add(this.line2),setTimeout((()=>{n()}),100),window.addEventListener("resize",n)}shouldComponentUpdate(t,i,e){return this.props.name!==t.name&&this.refresh(t.name),!0}getPath(){return this.path}render(){return(0,w.jsx)("div",{style:{height:"100%"},children:(0,w.jsxs)("div",{style:{position:"relative",width:this.state.width,height:this.state.height},ref:this.container,children:[(0,w.jsx)("div",{style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:3},children:(0,w.jsx)("div",{ref:this.instance,style:{width:"100%",height:"100%"}})}),(0,w.jsx)("div",{style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:2},children:(0,w.jsx)("img",{style:{width:"100%",height:"100%"},src:this.state.imgUrl,alt:"cameraOne"})})]})})}})||s),z=x,b=e(67471),j=l.Z.Option,S=(a=(0,c.$j)((t=>{var i=t.configProvider;return{configProvider:i}})),a(r=class extends o.Component{constructor(){super(...arguments),this.state={camera:"",height:600},this.container=(0,o.createRef)(),this.calibratorDiv=(0,o.createRef)(),this.calibrator=(0,o.createRef)()}handleChange(t){this.setState({camera:t})}resize(){var t,i,e=null===(t=this.container)||void 0===t||null===(i=t.current)||void 0===i?void 0:i.clientHeight;e&&this.setState({height:e-52})}componentDidMount(){this.resize(),window.addEventListener("resize",(()=>{this.resize()}))}save(){var t,i,e=null===(t=this.calibrator)||void 0===t||null===(i=t.current)||void 0===i?void 0:i.getPath();b.K.saveCalibrate(this.state.camera,e)}reset(){var t,i;null===(t=this.calibrator)||void 0===t||null===(i=t.current)||void 0===i||i.refresh()}render(){for(var t=[],i=Object.keys(this.props.configProvider.calibrator.cameras),h=0;h<i.length;h++)this.props.configProvider.calibrator.cameras[i[h]].isCalibrated&&t.push((0,w.jsx)(j,{children:i[h]},i[h]));return(0,w.jsxs)("div",{style:{height:"100%"},ref:this.container,children:[(0,w.jsxs)("div",{style:{paddingBottom:10,paddingTop:10},children:[(0,w.jsx)(l.Z,{style:{width:200},onChange:t=>this.handleChange(t),children:t}),(0,w.jsxs)("div",{style:{display:"inline",float:"right"},children:[(0,w.jsx)(n.Z,{onClick:()=>this.reset(),disabled:!this.state.camera,children:"Reset"}),"\xa0",(0,w.jsx)(n.Z,{onClick:()=>this.save(),type:"primary",disabled:!this.state.camera,children:"Save"})]})]}),(0,w.jsx)("div",{style:{height:this.state.height},ref:this.calibratorDiv,children:this.state.camera?(0,w.jsx)(z,{name:this.state.camera,ref:this.calibrator}):(0,w.jsx)("img",{src:e(2237),alt:"noCameraSelect",style:{maxWidth:"100%",maxHeight:"100%"}})})]})}})||r),C=S},2237:function(t,i,e){t.exports=e.p+"static/noCamera.cf3ae0a9.png"}}]);